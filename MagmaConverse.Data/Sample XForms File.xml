<xh:html xmlns:xh="http://www.w3.org/1999/xhtml"
         xmlns:xxf="http://orbeon.org/oxf/xml/xforms"
         xmlns:xxi="http://orbeon.org/oxf/xml/xinclude"
         xmlns:saxon="http://saxon.sf.net/"
         xmlns:fr="http://orbeon.org/oxf/xml/form-runner"
         xmlns:xf="http://www.w3.org/2002/xforms"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xmlns:sql="http://orbeon.org/oxf/xml/sql"
         xmlns:ev="http://www.w3.org/2001/xml-events"
         xmlns:xi="http://www.w3.org/2001/XInclude"
         xmlns:exf="http://www.exforms.org/exf/1-0"
         xmlns:xs="http://www.w3.org/2001/XMLSchema"
         xmlns:fb="http://orbeon.org/oxf/xml/form-builder"
         xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"
         fr:data-format-version="4.0.0">
  
  <xh:head>
    <xh:title>ADP Small Business Payroll Registration</xh:title>
  
    <xh:style type="text/css">
      .btnValidateAddress { font-size: small; }
    </xh:style>
    
    <xf:model id="fr-form-model" xxf:expose-xpath-types="true">

      <!-- Main instance -->
      <xf:instance id="fr-form-instance" xxf:exclude-result-prefixes="#all" xxf:index="id">
        <form>
          <sectionBasicCompanyInfo>
            <businessName/>
            <isNewBusiness/>
            <EIN/>
            <numEmployees/>
            <payFrequency/>
            <isDBA/>
          </sectionBasicCompanyInfo>
          <sectionCompanyContactInfo>
            <address/>
            <city/>
            <state/>
            <zipCode/>
            <btnValidateAddress/>
            <email/>
            <phone/>
          </sectionCompanyContactInfo>
          <sectionEmployees>
            <grid-17>
              <grid-17-iteration>
                <employeeName/>
                <employeeSSN/>
              </grid-17-iteration>
            </grid-17>
          </sectionEmployees>
        </form>
      </xf:instance>

      <!-- Bindings -->
      <xf:bind id="fr-form-binds" ref="instance('fr-form-instance')">
        <xf:bind id="sectionBasicCompanyInfo-bind" name="sectionBasicCompanyInfo"
                 ref="sectionBasicCompanyInfo">
          <xf:bind id="businessName-bind" name="businessName" ref="businessName"
                   xxf:whitespace="trim"
                   required="true()"/>
          <xf:bind id="isNewBusiness-bind" ref="isNewBusiness" name="isNewBusiness"
                   type="xs:boolean"
                   required="true()"/>
          <xf:bind id="EIN-bind" ref="EIN" name="EIN" xxf:whitespace="trim" required="true()">
            <xf:constraint id="validation-7-validation" value="matches(., '^\d\d-\d\d\d\d\d\d\d$')"/>
          </xf:bind>
          <xf:bind id="numEmployees-bind" ref="numEmployees" name="numEmployees" type="xs:integer"
                   required="true()">
            <xf:constraint id="validation-10-validation" value=". &gt;= 1 and . &lt;= 50"/>
          </xf:bind>
          <xf:bind id="payFrequency-bind" ref="payFrequency" name="payFrequency" required="true()"/>
          <xf:bind id="isDBA-bind" ref="isDBA" name="isDBA" type="xs:boolean" required="true()"
                   xxf:default="false()"/>
        </xf:bind>
        <xf:bind id="sectionCompanyContactInfo-bind" ref="sectionCompanyContactInfo"
                 name="sectionCompanyContactInfo">
          <xf:bind id="address-bind" ref="address" name="address" xxf:whitespace="trim"
                   required="true()"/>
          <xf:bind id="city-bind" ref="city" name="city" xxf:whitespace="trim" required="true()"/>
          <xf:bind id="state-bind" ref="state" name="state" required="true()"/>
          <xf:bind id="zipCode-bind" ref="zipCode" name="zipCode" xxf:whitespace="trim"
                   constraint="matches(., '\d{5}')"
                   required="true()"/>
          <xf:bind id="email-bind" ref="email" name="email" type="xf:email" xxf:whitespace="trim"
                   required="true()"/>
          <xf:bind id="phone-bind" ref="phone" name="phone"
                   constraint=". = '' or matches(., '^\d{10}$')"
                   required="true()"/>
          <xf:bind id="btnValidateAddress-bind" ref="btnValidateAddress" name="btnValidateAddress"
                   relevant="$zipCode != ''"/>
        </xf:bind>
        <xf:bind id="sectionEmployees-bind" ref="sectionEmployees" name="sectionEmployees">
          <xf:bind id="grid-17-bind" ref="grid-17" name="grid-17">
            <xf:bind id="grid-17-iteration-bind" ref="grid-17-iteration" name="grid-17-iteration">
              <xf:bind id="employeeName-bind" ref="employeeName" name="employeeName"
                       xxf:whitespace="trim"
                       required="true()"/>
              <xf:bind id="employeeSSN-bind" ref="employeeSSN" name="employeeSSN"
                       xxf:whitespace="trim"
                       required="true()"
                       constraint="matches(., '\d{3}-\d{2}-\d{4}')"/>
            </xf:bind>
          </xf:bind>
        </xf:bind>
      </xf:bind>

      <!-- Metadata -->
      <xf:instance xxf:readonly="true" id="fr-form-metadata" xxf:exclude-result-prefixes="#all">
        <metadata>
          <application-name>SBS-Payroll-Onboarding</application-name>
          <form-name>DIY-Onboarding</form-name>
          <title xml:lang="en">ADP Small Business Payroll Registration</title>
          <description xml:lang="en">If you are a small business, with 50 employees or less, you can register your business to receive payroll services from ADP.</description>
        </metadata>
      </xf:instance>

      <!-- Attachments -->
      <xf:instance id="fr-form-attachments" xxf:exclude-result-prefixes="#all">
        <attachments>
          <css mediatype="text/css" filename="" size=""/>
          <pdf mediatype="application/pdf" filename="" size=""/>
        </attachments>
      </xf:instance>

      <!-- All form resources -->
      <xf:instance xxf:readonly="true" id="fr-form-resources" xxf:exclude-result-prefixes="#all">
        <resources>
          <resource xml:lang="en">
            <employeeName>
              <label>Name</label>
              <hint/>
            </employeeName>
            <employeeSSN>
              <label>SSN</label>
              <hint>&lt;i&gt;Example: 123-45-6789&lt;/i&gt;</hint>
            </employeeSSN>
            <address>
              <label>What is your company's physical address?</label>
              <hint>&lt;i&gt;Do not use a PO Box&lt;/i&gt;</hint>
            </address>
            <city>
              <label>City</label>
              <hint/>
            </city>
            <state>
              <label>State</label>
              <hint/>
            </state>
            <zipCode>
              <label>Zip</label>
              <hint>&lt;i&gt;Use the 5 digit zip&lt;/i&gt;</hint>
            </zipCode>
            <btnValidateAddress>
              <label>Validate Address</label>
              <hint/>
            </btnValidateAddress>
            <email>
              <label>Business email address</label>
              <hint/>
            </email>
            <phone>
              <label>Business phone number</label>
              <hint/>
            </phone>
            <sectionBasicCompanyInfo>
              <label>Basic Company Information</label>
            </sectionBasicCompanyInfo>
            <businessName>
              <label>What is the name of your business?</label>
              <hint>&lt;i&gt;Enter the legal name of your business&lt;/i&gt;</hint>
            </businessName>
            <isNewBusiness>
              <label>Is this a new business?</label>
              <hint/>
            </isNewBusiness>
            <EIN>
              <label>What is the Federal EIN of your business?</label>
              <hint>&lt;i&gt;The EIN should be 2 digits, a dash, and 7 digits&lt;/i&gt;</hint>
              <alert>The format of the EIN should be two digits, a dash, and the remaining seven digits</alert>
            </EIN>
            <numEmployees>
              <label>How many employees do you have?</label>
              <hint>&lt;i&gt;Type a number between 1 and 50, and include yourself&lt;/i&gt;</hint>
              <alert>You need to have no more than 50 employees</alert>
            </numEmployees>
            <payFrequency>
              <label>How often do you pay your employees?</label>
              <hint/>
              <item>
                <label>Every week</label>
                <value>weekly</value>
              </item>
              <item>
                <label>Every 2 weeks</label>
                <value>biweekly</value>
              </item>
              <item>
                <label>Every month</label>
                <value>monthly</value>
              </item>
            </payFrequency>
            <isDBA>
              <label>Is this business a DBA?</label>
              <hint>&lt;i&gt;DBA stands for Doing-Business-As&lt;/i&gt;</hint>
            </isDBA>
            <sectionCompanyContactInfo>
              <label>Company Contact Information</label>
              <help/>
            </sectionCompanyContactInfo>
            <sectionEmployees>
              <label>Employee Information</label>
              <help/>
            </sectionEmployees>
          </resource>
        </resources>
      </xf:instance>
      <xf:instance id="BusinessAddressValidationService-instance" class="fr-service"
                   xxf:exclude-result-prefixes="#all">
        <body xmlns:fbf="java:org.orbeon.oxf.fb.FormBuilder"
              xmlns:xxbl="http://orbeon.org/oxf/xml/xbl">
          &lt;params&gt;
          &lt;address&gt;//address&lt;/address&gt;
          &lt;city&gt;//city&lt;/city&gt;
          &lt;state&gt;//state&lt;/state&gt;
          &lt;zipCode&gt;//zipCode&lt;/zipCode&gt;
          &lt;/params&gt;
        </body>
      </xf:instance>
      <xf:instance xxf:readonly="true" id="grid-17-template" xxf:exclude-result-prefixes="#all">
        <grid-17-iteration>
          <employeeName/>
          <employeeSSN/>
        </grid-17-iteration>
      </xf:instance>
      <xf:submission id="BusinessAddressValidationService-submission" class="fr-service"
                     resource="http://localhost:3000/api/DIYOnboarding/business/address/validate"
                     method="get"
                     serialization="application/x-www-form-urlencoded"
                     mediatype="application/x-www-form-urlencoded"/>
      <xf:action id="ValidateBusinessAddress-binding">
        <xf:action event="DOMActivate" ev:observer="btnValidateAddress-control" if="true()">
          <xf:send submission="BusinessAddressValidationService-submission"/>
        </xf:action>
        <xf:action event="xforms-submit" ev:observer="BusinessAddressValidationService-submission">
          <xf:var name="request-instance-name"
                  value="'BusinessAddressValidationService-instance'"/>
          <xf:action/>
        </xf:action>
        <xf:action event="xforms-submit-done"
                   ev:observer="BusinessAddressValidationService-submission"/>
      </xf:action>
    </xf:model>
  </xh:head>
  
  <xh:body>
    <fr:view>
      <fr:body xmlns:xbl="http://www.w3.org/ns/xbl" xmlns:p="http://www.orbeon.com/oxf/pipeline"
               xmlns:oxf="http://www.orbeon.com/oxf/processors">
        <fr:section id="sectionBasicCompanyInfo-control" bind="sectionBasicCompanyInfo-bind">
          <xf:label ref="$form-resources/sectionBasicCompanyInfo/label"/>
          <fr:grid>
            <xh:tr>
              <xh:td>
                <xf:input id="businessName-control" bind="businessName-bind">
                  <xf:label ref="$form-resources/businessName/label"/>
                  <xf:hint ref="$form-resources/businessName/hint" mediatype="text/html"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                </xf:input>
              </xh:td>
              <xh:td>
                <fr:yesno-input xmlns="http://orbeon.org/oxf/xml/form-builder"
                                xmlns:xxbl="http://orbeon.org/oxf/xml/xbl"
                                id="isNewBusiness-control"
                                bind="isNewBusiness-bind">
                  <xf:label ref="$form-resources/isNewBusiness/label"/>
                  <xf:hint ref="$form-resources/isNewBusiness/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                </fr:yesno-input>
              </xh:td>
            </xh:tr>
            <xh:tr>
              <xh:td>
                <xf:input id="EIN-control" bind="EIN-bind">
                  <xf:label ref="$form-resources/EIN/label"/>
                  <xf:hint ref="$form-resources/EIN/hint" mediatype="text/html"/>
                  <xf:alert ref="$form-resources/EIN/alert" validation="validation-7-validation"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                </xf:input>
              </xh:td>
              <xh:td>
                <fr:number xmlns="http://orbeon.org/oxf/xml/form-builder"
                           xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                           xmlns:xxbl="http://orbeon.org/oxf/xml/xbl"
                           id="numEmployees-control"
                           bind="numEmployees-bind">
                  <xf:label ref="$form-resources/numEmployees/label"/>
                  <xf:hint ref="$form-resources/numEmployees/hint" mediatype="text/html"/>
                  <xf:alert ref="$form-resources/numEmployees/alert" validation="validation-10-validation"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                </fr:number>
              </xh:td>
            </xh:tr>
            <xh:tr>
              <xh:td>
                <xf:select1 id="payFrequency-control" bind="payFrequency-bind" appearance="dropdown">
                  <xf:label ref="$form-resources/payFrequency/label"/>
                  <xf:hint ref="$form-resources/payFrequency/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                  <xf:itemset ref="$form-resources/payFrequency/item">
                    <xf:label ref="label"/>
                    <xf:value ref="value"/>
                  </xf:itemset>
                </xf:select1>
              </xh:td>
              <xh:td>
                <fr:yesno-input xmlns="http://orbeon.org/oxf/xml/form-builder"
                                xmlns:xxbl="http://orbeon.org/oxf/xml/xbl"
                                id="isDBA-control"
                                bind="isDBA-bind">
                  <xf:label ref="$form-resources/isDBA/label"/>
                  <xf:hint ref="$form-resources/isDBA/hint" mediatype="text/html"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                </fr:yesno-input>
              </xh:td>
            </xh:tr>
          </fr:grid>
        </fr:section>
        <fr:section id="sectionCompanyContactInfo-control" bind="sectionCompanyContactInfo-bind">
          <xf:label ref="$form-resources/sectionCompanyContactInfo/label"/>
          <fr:grid>
            <xh:tr>
              <xh:td colspan="4">
                <xf:input id="address-control" bind="address-bind">
                  <xf:label ref="$form-resources/address/label"/>
                  <xf:hint ref="$form-resources/address/hint" mediatype="text/html"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                </xf:input>
              </xh:td>
            </xh:tr>
            <xh:tr>
              <xh:td>
                <xf:input id="city-control" bind="city-bind">
                  <xf:label ref="$form-resources/city/label"/>
                  <xf:hint ref="$form-resources/city/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                </xf:input>
              </xh:td>
              <xh:td>
                <fr:us-state xmlns="http://orbeon.org/oxf/xml/form-builder"
                             xmlns:xxbl="http://orbeon.org/oxf/xml/xbl"
                             id="state-control"
                             bind="state-bind">
                  <xf:label ref="$form-resources/state/label"/>
                  <xf:hint ref="$form-resources/state/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                </fr:us-state>
              </xh:td>
              <xh:td>
                <xf:input id="zipCode-control" bind="zipCode-bind">
                  <xf:label ref="$form-resources/zipCode/label"/>
                  <xf:hint ref="$form-resources/zipCode/hint" mediatype="text/html"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                </xf:input>
              </xh:td>
              <xh:td>
                <xf:trigger id="btnValidateAddress-control" bind="btnValidateAddress-bind"
                            class="btnValidateAddress">
                  <xf:label ref="$form-resources/btnValidateAddress/label"/>
                  <xf:hint ref="$form-resources/btnValidateAddress/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                </xf:trigger>
              </xh:td>
            </xh:tr>
            <xh:tr>
              <xh:td colspan="2">
                <xf:input id="email-control" bind="email-bind">
                  <xf:label ref="$form-resources/email/label"/>
                  <xf:hint ref="$form-resources/email/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                </xf:input>
              </xh:td>
              <xh:td colspan="2">
                <fr:us-phone xmlns="http://orbeon.org/oxf/xml/form-builder"
                             xmlns:xxbl="http://orbeon.org/oxf/xml/xbl"
                             id="phone-control"
                             bind="phone-bind">
                  <xf:label ref="$form-resources/phone/label"/>
                  <xf:hint ref="$form-resources/phone/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                </fr:us-phone>
              </xh:td>
            </xh:tr>
          </fr:grid>
        </fr:section>
        <fr:section id="sectionEmployees-control" bind="sectionEmployees-bind">
          <xf:label ref="$form-resources/sectionEmployees/label"/>
          <fr:grid id="grid-17-grid" bind="grid-17-bind" repeat="content" min="1"
                   template="instance('grid-17-template')"
                   apply-defaults="true"
                   fb:initial-iterations="first">
            <xh:tr>
              <xh:td>
                <xf:input id="employeeName-control" bind="employeeName-bind">
                  <xf:label ref="$form-resources/employeeName/label"/>
                  <xf:hint ref="$form-resources/employeeName/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                </xf:input>
              </xh:td>
              <xh:td>
                <xf:input id="employeeSSN-control" bind="employeeSSN-bind">
                  <xf:label ref="$form-resources/employeeSSN/label"/>
                  <xf:hint ref="$form-resources/employeeSSN/hint"/>
                  <xf:alert ref="$fr-resources/detail/labels/alert"/>
                </xf:input>
              </xh:td>
            </xh:tr>
          </fr:grid>
        </fr:section>
      </fr:body>
    </fr:view>
  </xh:body>
</xh:html>
